import{a as i}from"./chunk-AIQ2VSE7.js";import{Ma as a,Z as l,e as c}from"./chunk-M5WQ34XW.js";var y=(()=>{class s{constructor(){this.API_URL="https://api.openweathermap.org/data/2.5/weather",this.weather=a(null),this.isLoading=a(!1),this.error=a(null),console.log("WeatherService initialized"),console.log("API configured:",this.isConfigured()),console.log("API key:",i.weatherApiKey?"Present":"Missing"),this.loadWeather(),setInterval(()=>this.loadWeather(),10*60*1e3)}isConfigured(){return!!i.weatherApiKey&&i.weatherApiKey!=="YOUR_OPENWEATHER_API_KEY"}loadWeather(){if(console.log("loadWeather() called"),!this.isConfigured()){console.error("Weather service not configured - API key missing or invalid"),this.error.set("Weather API not configured. Check environment.ts");return}console.log("Weather service is configured, attempting to load weather..."),navigator.geolocation?(console.log("Attempting to get geolocation..."),navigator.geolocation.getCurrentPosition(e=>{console.log("Geolocation success:",e.coords.latitude,e.coords.longitude),this.fetchWeatherByCoords(e.coords.latitude,e.coords.longitude)},e=>{console.log("Geolocation failed, using default city:",e.message),this.fetchWeatherByCity(i.defaultCity||"Minneapolis")},{timeout:5e3,maximumAge:3e5,enableHighAccuracy:!1})):(console.log("Geolocation not available, using default city"),this.fetchWeatherByCity(i.defaultCity||"Minneapolis"))}fetchWeatherByCoords(e,t){return c(this,null,function*(){this.isLoading.set(!0),this.error.set(null);try{let r=`${this.API_URL}?lat=${e}&lon=${t}&units=imperial&appid=${i.weatherApiKey}`;console.log("Fetching weather by coordinates:",e,t);let o=yield fetch(r);if(!o.ok){if(o.status===401)throw new Error("Invalid API key. Please check your OpenWeatherMap API key.");let h=yield o.json().catch(()=>({}));throw new Error(h.message||`Weather API error: ${o.status}`)}let n=yield o.json();console.log("Weather data received:",n),this.weather.set(this.parseWeatherData(n))}catch(r){console.error("Error fetching weather by coords:",r),this.error.set(r.message)}finally{this.isLoading.set(!1)}})}fetchWeatherByCity(e){return c(this,null,function*(){this.isLoading.set(!0),this.error.set(null);try{let t=`${this.API_URL}?q=${e}&units=imperial&appid=${i.weatherApiKey}`;console.log("Fetching weather for city:",e);let r=yield fetch(t);if(!r.ok){if(r.status===401)throw new Error("Invalid API key. Please check your OpenWeatherMap API key.");let n=yield r.json().catch(()=>({}));throw new Error(n.message||`Weather API error: ${r.status}`)}let o=yield r.json();console.log("Weather data received:",o),this.weather.set(this.parseWeatherData(o))}catch(t){console.error("Error fetching weather by city:",t),this.error.set(t.message)}finally{this.isLoading.set(!1)}})}parseWeatherData(e){console.log("Parsing weather data:",e);let t={temperature:Math.round(e.main.temp),feelsLike:Math.round(e.main.feels_like),conditions:e.weather[0].main,description:e.weather[0].description,precipitation:e.rain?.["1h"]||e.snow?.["1h"]||0,humidity:e.main.humidity,windSpeed:Math.round(e.wind.speed),windDirection:e.wind.deg,icon:e.weather[0].icon,city:e.name,sunrise:new Date(e.sys.sunrise*1e3),sunset:new Date(e.sys.sunset*1e3)};return console.log("Parsed weather data:",t),t}getWeatherConditionClass(){let e=this.weather();if(!e)return"clear";let t=e.conditions.toLowerCase();return t.includes("rain")?"rainy":t.includes("snow")?"snowy":t.includes("cloud")?"cloudy":t.includes("clear")?"clear":t.includes("thunder")?"stormy":t.includes("fog")||t.includes("mist")?"foggy":"clear"}static{this.\u0275fac=function(t){return new(t||s)}}static{this.\u0275prov=l({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();export{y as a};
