import{B as F,C as _,D as $,G as L,H as N,c as v,e as A,f as x,h as I,p as D,x as k,y as R}from"./chunk-KMETSRJJ.js";import{a as f}from"./chunk-5N4AXTGP.js";import{Z as P,e as u}from"./chunk-M5WQ34XW.js";var Y="type.googleapis.com/google.protobuf.Int64Value",K="type.googleapis.com/google.protobuf.UInt64Value";function j(e,n){let r={};for(let t in e)e.hasOwnProperty(t)&&(r[t]=n(e[t]));return r}function E(e){if(e==null)return null;if(e instanceof Number&&(e=e.valueOf()),typeof e=="number"&&isFinite(e)||e===!0||e===!1||Object.prototype.toString.call(e)==="[object String]")return e;if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return e.map(n=>E(n));if(typeof e=="function"||typeof e=="object")return j(e,n=>E(n));throw new Error("Data cannot be encoded in JSON: "+e)}function m(e){if(e==null)return e;if(e["@type"])switch(e["@type"]){case Y:case K:{let n=Number(e.value);if(isNaN(n))throw new Error("Data cannot be decoded from JSON: "+e);return n}default:throw new Error("Data cannot be decoded from JSON: "+e)}return Array.isArray(e)?e.map(n=>m(n)):typeof e=="function"||typeof e=="object"?j(e,n=>m(n)):e}var O="functions";var U={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},h=class e extends D{constructor(n,r,t){super(`${O}/${n}`,r||""),this.details=t,Object.setPrototypeOf(this,e.prototype)}};function W(e){if(e>=200&&e<300)return"ok";switch(e){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function T(e,n){let r=W(e),t=r,o;try{let s=n&&n.error;if(s){let i=s.status;if(typeof i=="string"){if(!U[i])return new h("internal","internal");r=U[i],t=i}let a=s.message;typeof a=="string"&&(t=a),o=s.details,o!==void 0&&(o=m(o))}}catch{}return r==="ok"?null:new h(r,t,o)}var b=class{constructor(n,r,t,o){this.app=n,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,$(n)&&n.settings.appCheckToken&&(this.serverAppAppCheckToken=n.settings.appCheckToken),this.auth=r.getImmediate({optional:!0}),this.messaging=t.getImmediate({optional:!0}),this.auth||r.get().then(s=>this.auth=s,()=>{}),this.messaging||t.get().then(s=>this.messaging=s,()=>{}),this.appCheck||o?.get().then(s=>this.appCheck=s,()=>{})}getAuthToken(){return u(this,null,function*(){if(this.auth)try{return(yield this.auth.getToken())?.accessToken}catch{return}})}getMessagingToken(){return u(this,null,function*(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return yield this.messaging.getToken()}catch{return}})}getAppCheckToken(n){return u(this,null,function*(){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){let r=n?yield this.appCheck.getLimitedUseToken():yield this.appCheck.getToken();return r.error?null:r.token}return null})}getContext(n){return u(this,null,function*(){let r=yield this.getAuthToken(),t=yield this.getMessagingToken(),o=yield this.getAppCheckToken(n);return{authToken:r,messagingToken:t,appCheckToken:o}})}};var C="us-central1",X=/^data: (.*?)(?:\n|$)/;function z(e){let n=null;return{promise:new Promise((r,t)=>{n=setTimeout(()=>{t(new h("deadline-exceeded","deadline-exceeded"))},e)}),cancel:()=>{n&&clearTimeout(n)}}}var S=class{constructor(n,r,t,o,s=C,i=(...a)=>fetch(...a)){this.app=n,this.fetchImpl=i,this.emulatorOrigin=null,this.contextProvider=new b(n,r,t,o),this.cancelAllRequests=new Promise(a=>{this.deleteService=()=>Promise.resolve(a())});try{let a=new URL(s);this.customDomain=a.origin+(a.pathname==="/"?"":a.pathname),this.region=C}catch{this.customDomain=null,this.region=s}}_delete(){return this.deleteService()}_url(n){let r=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${r}/${this.region}/${n}`:this.customDomain!==null?`${this.customDomain}/${n}`:`https://${this.region}-${r}.cloudfunctions.net/${n}`}};function Q(e,n,r){let t=A(n);e.emulatorOrigin=`http${t?"s":""}://${n}:${r}`,t&&(x(e.emulatorOrigin+"/backends"),I("Functions",!0))}function Z(e,n,r){let t=o=>te(e,n,o,r||{});return t.stream=(o,s)=>ne(e,n,o,s),t}function G(e){return e.emulatorOrigin&&A(e.emulatorOrigin)?"include":void 0}function ee(e,n,r,t,o){return u(this,null,function*(){r["Content-Type"]="application/json";let s;try{s=yield t(e,{method:"POST",body:JSON.stringify(n),headers:r,credentials:G(o)})}catch{return{status:0,json:null}}let i=null;try{i=yield s.json()}catch{}return{status:s.status,json:i}})}function H(e,n){return u(this,null,function*(){let r={},t=yield e.contextProvider.getContext(n.limitedUseAppCheckTokens);return t.authToken&&(r.Authorization="Bearer "+t.authToken),t.messagingToken&&(r["Firebase-Instance-ID-Token"]=t.messagingToken),t.appCheckToken!==null&&(r["X-Firebase-AppCheck"]=t.appCheckToken),r})}function te(e,n,r,t){let o=e._url(n);return re(e,o,r,t)}function re(e,n,r,t){return u(this,null,function*(){r=E(r);let o={data:r},s=yield H(e,t),i=t.timeout||7e4,a=z(i),l=yield Promise.race([ee(n,o,s,e.fetchImpl,e),a.promise,e.cancelAllRequests]);if(a.cancel(),!l)throw new h("cancelled","Firebase Functions instance was deleted.");let d=T(l.status,l.json);if(d)throw d;if(!l.json)throw new h("internal","Response is not valid JSON object.");let c=l.json.data;if(typeof c>"u"&&(c=l.json.result),typeof c>"u")throw new h("internal","Response is missing data field.");return{data:m(c)}})}function ne(e,n,r,t){let o=e._url(n);return oe(e,o,r,t||{})}function oe(e,n,r,t){return u(this,null,function*(){r=E(r);let o={data:r},s=yield H(e,t);s["Content-Type"]="application/json",s.Accept="text/event-stream";let i;try{i=yield e.fetchImpl(n,{method:"POST",body:JSON.stringify(o),headers:s,signal:t?.signal,credentials:G(e)})}catch(p){if(p instanceof Error&&p.name==="AbortError"){let y=new h("cancelled","Request was cancelled.");return{data:Promise.reject(y),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(y)}}}}}}let w=T(0,null);return{data:Promise.reject(w),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(w)}}}}}}let a,l,d=new Promise((p,w)=>{a=p,l=w});t?.signal?.addEventListener("abort",()=>{let p=new h("cancelled","Request was cancelled.");l(p)});let c=i.body.getReader(),g=se(c,a,l,t?.signal);return{stream:{[Symbol.asyncIterator](){let p=g.getReader();return{next(){return u(this,null,function*(){let{value:y,done:V}=yield p.read();return{value:y,done:V}})},return(){return u(this,null,function*(){return yield p.cancel(),{done:!0,value:void 0}})}}}},data:d}})}function se(e,n,r,t){let o=(i,a)=>{let l=i.match(X);if(!l)return;let d=l[1];try{let c=JSON.parse(d);if("result"in c){n(m(c.result));return}if("message"in c){a.enqueue(m(c.message));return}if("error"in c){let g=T(0,c);a.error(g),r(g);return}}catch(c){if(c instanceof h){a.error(c),r(c);return}}},s=new TextDecoder;return new ReadableStream({start(i){let a="";return l();function l(){return u(this,null,function*(){if(t?.aborted){let d=new h("cancelled","Request was cancelled");return i.error(d),r(d),Promise.resolve()}try{let{value:d,done:c}=yield e.read();if(c){a.trim()&&o(a.trim(),i),i.close();return}if(t?.aborted){let p=new h("cancelled","Request was cancelled");i.error(p),r(p),yield e.cancel();return}a+=s.decode(d,{stream:!0});let g=a.split(`
`);a=g.pop()||"";for(let p of g)p.trim()&&o(p.trim(),i);return l()}catch(d){let c=d instanceof h?d:T(0,null);i.error(c),r(c)}})}},cancel(){return e.cancel()}})}var M="@firebase/functions",J="0.13.1";var ie="auth-internal",ae="app-check-internal",ce="messaging-internal";function ue(e){let n=(r,{instanceIdentifier:t})=>{let o=r.getProvider("app").getImmediate(),s=r.getProvider(ie),i=r.getProvider(ce),a=r.getProvider(ae);return new S(o,s,i,a,t)};F(new R(O,n,"PUBLIC").setMultipleInstances(!0)),N(M,J,e),N(M,J,"esm2020")}function q(e=L(),n=C){let t=_(k(e),O).getImmediate({identifier:n}),o=v("functions");return o&&le(t,...o),t}function le(e,n,r){Q(k(e),n,r)}function B(e,n,r){return Z(k(e),n,r)}ue();var Te=(()=>{class e{constructor(){this.useFirebaseProxy=f.production||f.useFirebaseProxy}isConfigured(){return!!f.githubToken&&f.githubToken!=="GHAI_TOKEN"&&(f.githubToken.startsWith("github_pat_")||f.githubToken.startsWith("ghp_"))}suggestRecipes(r,t){return u(this,null,function*(){let o=`${t?t+`

`:""}Generate 3 recipe suggestions based on: ${r}

Please respond with a JSON array of recipes in this exact format:
[
  {
    "name": "Recipe Name",
    "description": "Brief description",
    "prepTime": 15,
    "cookTime": 30,
    "servings": 4,
    "ingredients": ["ingredient 1", "ingredient 2"],
    "instructions": ["step 1", "step 2"],
    "tags": ["tag1", "tag2"]
  }
]

Only return valid JSON, no additional text.`,s=yield this.generateContent(o);if(!s.success)throw new Error(s.error||"Failed to generate recipe suggestions");try{let i=s.text.match(/\[[\s\S]*\]/);if(!i)throw new Error("No valid JSON found in response");return JSON.parse(i[0])}catch(i){throw console.error("Error parsing recipe suggestions:",i),new Error("Failed to parse recipe suggestions")}})}suggestGroceries(r,t){return u(this,null,function*(){let o=t?.length?`

Existing items (don't duplicate): ${t.join(", ")}`:"",s=`Based on these planned recipes: ${r.join(", ")}${o}

Generate a comprehensive grocery list. Return only a JSON array of strings, no additional text:
["item 1", "item 2", "item 3"]`,i=yield this.generateContent(s);if(!i.success)throw new Error(i.error||"Failed to generate grocery suggestions");try{let a=i.text.match(/\[[\s\S]*\]/);if(!a)throw new Error("No valid JSON found in response");return JSON.parse(a[0])}catch(a){throw console.error("Error parsing grocery suggestions:",a),new Error("Failed to parse grocery suggestions")}})}suggestMealPlan(r,t=7){return u(this,null,function*(){let o=`Create a ${t}-day meal plan based on: ${r}

Return only a JSON array in this format, no additional text:
[
  {
    "day": "Monday",
    "breakfast": "meal name",
    "lunch": "meal name",
    "dinner": "meal name",
    "snacks": ["snack 1", "snack 2"]
  }
]`,s=yield this.generateContent(o);if(!s.success)throw new Error(s.error||"Failed to generate meal plan");try{let i=s.text.match(/\[[\s\S]*\]/);if(!i)throw new Error("No valid JSON found in response");return JSON.parse(i[0])}catch(i){throw console.error("Error parsing meal plan:",i),new Error("Failed to parse meal plan")}})}suggestRestaurants(r,t){return u(this,null,function*(){let o=`Suggest 3-5 ${r} restaurants or food delivery options. ${t?`Preferences: ${t}`:""}
    
Provide brief descriptions and what makes each one special. Format as a simple text list.`,s=yield this.generateContent(o);if(!s.success)throw new Error(s.error||"Failed to generate restaurant suggestions");return s.text})}generateContent(r){return u(this,null,function*(){if(!this.isConfigured())return{success:!1,text:"",error:"AI service not configured."};try{if(this.useFirebaseProxy){let i=q(),l=yield B(i,"aiProxy")({prompt:r});return this.incrementApiCounter(),l.data}let t=yield fetch("https://models.inference.ai.azure.com/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${f.githubToken}`},body:JSON.stringify({messages:[{role:"user",content:r}],model:"gpt-4o-mini",temperature:.7,max_tokens:4096})});if(!t.ok){let i=yield t.json().catch(()=>({}));throw console.error("GitHub Models API Error Details:",{status:t.status,statusText:t.statusText,error:i}),new Error(i.error?.message||`API request failed: ${t.status} - ${t.statusText}`)}let o=yield t.json();if(!o.choices||!o.choices[0]?.message?.content)throw new Error("Invalid response format from GitHub Models API");let s=o.choices[0].message.content;return this.incrementApiCounter(),{success:!0,text:s}}catch(t){return console.error("AI API error:",t),{success:!1,text:"",error:t.message||"Unknown error occurred"}}})}incrementApiCounter(){let t=parseInt(localStorage.getItem("githubApiCallCount")||"0",10)+1;localStorage.setItem("githubApiCallCount",t.toString()),window.dispatchEvent(new StorageEvent("storage",{key:"githubApiCallCount",newValue:t.toString()}))}getCookingHelp(r){return u(this,null,function*(){let t=`You are a helpful cooking assistant. Answer this question briefly and practically: ${r}`,o=yield this.generateContent(t);if(!o.success)throw new Error(o.error||"Failed to get cooking help");return o.text})}static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275prov=P({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();export{Te as a};
